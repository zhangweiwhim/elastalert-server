name: Test frequency rule

# (Required)
# Type of alert.
# the frequency rule type alerts when num_events events occur with timeframe time
type: frequency

# (Required)
# Index to search, wildcard supported
index: filebeat-*

# (Required, frequency specific)
# Alert when this many documents matching the query occur within a timeframe
num_events: 1

# (Required, frequency specific)
# num_events must occur within this amount of time to trigger an alert
timeframe:
  minutes: 10

# (Required)
# A list of Elasticsearch filters used for find events
# These filters are joined with AND and nested in a filtered query
# For more info: http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl.html
filter:
- term:
    message: "error"



# SMTP configration
smtp_host: smtp.cangoonline.com
smtp_port: 25

# SMTP auth
smtp_auth_file: /opt/elastalert/smtpAuth/smtp_auth_file.yaml
email_reply_to: dcadmin@cangoonline.com
from_addr: dcadmin@cangoonline.com


# 5分钟内相同的报警不会重复发送
realert:
   minutes: 5
#
#   # 指数级扩大 realert 时间，中间如果有报警，
#   # 则按照5>10>20>40>60不断增大报警时间到制定的最大时间，
#   # 如果之后报警减少，则会慢慢恢复原始realert时间
exponential_realert:
 hours: 1
#


# (Required)
# The alert is use when a match is found
alert:
- "email"
#- "elastalert_modules.wechat_qiye_alert.WeChatAlerter"
alert_subject: "Error {} @{}"
alert_subject_args:
  - name
  - "@timestamp"
alert_text: |
  ========start=========
  告警程序: elasticsearch_alert
  告警主题: U got an err alert message!
  触发时间: {}
  错误内容: {}
  num_hits: {}
  参考来源: {}
  ========end==========
alert_text_args:
 - "@timestamp"
 - message
 - num_hits
 - log.file.path

# (required, email specific)
# a list of email addresses to send alerts to
email:
- "zhangweish@cangoonline.com"